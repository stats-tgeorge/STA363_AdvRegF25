{
  "hash": "9d6b34fb21afeb5ab079f4d3e3af048e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Chapter 6 - Binomial Regression'\nsubtitle: 'Moth Coloration and Natural Selection'\n---\n\n\n## Setup \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(gridExtra) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'gridExtra' was built under R version 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'gridExtra'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n\n\n:::\n\n```{.r .cell-code}\nmoth <- read_csv(\"data/moth.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 14 Columns: 4\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): MORPH\ndbl (3): DISTANCE, PLACED, REMOVED\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nmoth <- mutate(moth, notremoved = PLACED - REMOVED, \n               logit1 = log(REMOVED / notremoved),\n               prop1 = REMOVED / PLACED, \n               dark = ifelse(MORPH==\"dark\",1,0) )\n\nmoth |> head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 8\n  MORPH DISTANCE PLACED REMOVED notremoved logit1 prop1  dark\n  <chr>    <dbl>  <dbl>   <dbl>      <dbl>  <dbl> <dbl> <dbl>\n1 light      0       56      17         39 -0.830 0.304     0\n2 dark       0       56      14         42 -1.10  0.25      1\n3 light      7.2     80      28         52 -0.619 0.35      0\n4 dark       7.2     80      20         60 -1.10  0.25      1\n5 light     24.1     52      18         34 -0.636 0.346     0\n```\n\n\n:::\n:::\n\n\n\n\n### Code Exercises 0-3\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# EDA\nggplot(data = moth, aes(x = DISTANCE, y = logit1)) + \n  geom_point() + geom_smooth(method=\"lm\") \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/eda-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(data = moth, aes(x = MORPH, y = logit1)) + \n  geom_boxplot() \n```\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/eda-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot empirical logits vs. distance separately by morph\nggplot(data = moth, aes(x = DISTANCE, y = logit1, color = MORPH, \n                        shape = MORPH)) + \n  geom_point() + \n  geom_smooth(method=\"lm\", alpha = 1/4) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/eda-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Repeat above plot but \"Connect the dots\" within morph\nggplot(data = moth, aes(x = DISTANCE, y = logit1, color = MORPH, \n                        shape = MORPH)) + \n  geom_point() + \n  geom_line() \n```\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/eda-4.png){width=672}\n:::\n:::\n\n\n### Code Exercises 3-5\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Initial model\nbreg2 <- glm(prop1 ~ DISTANCE + dark, weights = PLACED, family = binomial, \n             data = moth)\nsummary(breg2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ DISTANCE + dark, family = binomial, data = moth, \n    weights = PLACED)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.136742   0.156758  -7.252 4.12e-13 ***\nDISTANCE     0.005314   0.004002   1.328  0.18422    \ndark         0.404052   0.139377   2.899  0.00374 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 25.161  on 11  degrees of freedom\nAIC: 93.836\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\nexp(coef(breg2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)    DISTANCE        dark \n  0.3208626   1.0053278   1.4978822 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Alternative way to express initial model\nbreg2a <- glm(cbind(REMOVED, notremoved) ~ DISTANCE + dark, \n              family = binomial, data=moth)\nsummary(breg2a)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = cbind(REMOVED, notremoved) ~ DISTANCE + dark, family = binomial, \n    data = moth)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.136742   0.156758  -7.252 4.12e-13 ***\nDISTANCE     0.005314   0.004002   1.328  0.18422    \ndark         0.404052   0.139377   2.899  0.00374 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 25.161  on 11  degrees of freedom\nAIC: 93.836\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Yet one more way to express initial model\nbreg2b <- glm(prop1 ~ DISTANCE + MORPH, weights = PLACED, family = binomial, data = moth)\nsummary(breg2b)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ DISTANCE + MORPH, family = binomial, data = moth, \n    weights = PLACED)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -0.732690   0.151221  -4.845 1.27e-06 ***\nDISTANCE     0.005314   0.004002   1.328  0.18422    \nMORPHlight  -0.404052   0.139377  -2.899  0.00374 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 25.161  on 11  degrees of freedom\nAIC: 93.836\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n### Code Exercises 6-9\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot initial model (no interaction)\nmoth <- mutate(moth, breg2.pred = predict(breg2, type=\"link\") )\nggplot(data = moth, aes(x = DISTANCE, color = MORPH, shape = MORPH)) + \n  geom_point(aes(y = logit1)) + \n  geom_smooth(aes(y = breg2.pred), method=\"lm\") +\n  ggtitle(\"Initial model (no interaction)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/predictions_coef-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model with interaction (full model)\nbreg3 <- glm(prop1 ~ DISTANCE + dark + DISTANCE:dark, weights = PLACED, \n             family = binomial, data = moth)\nsummary(breg3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ DISTANCE + dark + DISTANCE:dark, family = binomial, \n    data = moth, weights = PLACED)\n\nCoefficients:\n               Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   -0.717729   0.190205  -3.773 0.000161 ***\nDISTANCE      -0.009287   0.005788  -1.604 0.108629    \ndark          -0.411257   0.274490  -1.498 0.134066    \nDISTANCE:dark  0.027789   0.008085   3.437 0.000588 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 13.230  on 10  degrees of freedom\nAIC: 83.904\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\n# Interpret exponentiated coefficients and associated profile CIs\nexp(coef(breg3))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n    0.4878587     0.9907562     0.6628165     1.0281788 \n```\n\n\n:::\n\n```{.r .cell-code}\nexp(confint(breg3))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWaiting for profiling to be done...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  2.5 %    97.5 %\n(Intercept)   0.3335844 0.7042152\nDISTANCE      0.9795673 1.0020840\ndark          0.3860419 1.1340516\nDISTANCE:dark 1.0120693 1.0446879\n```\n\n\n:::\n\n```{.r .cell-code}\n# Generate CIs - Wald-based method\nbetas <- summary(breg3)$coefficients[,1]\nsebetas <- summary(breg3)$coefficients[,2]\nlb <- betas - qnorm(.975)*sebetas\nub <- betas + qnorm(.975)*sebetas\ncbind(exp(lb),exp(ub))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                   [,1]      [,2]\n(Intercept)   0.3360403 0.7082667\nDISTANCE      0.9795796 1.0020603\ndark          0.3870322 1.1351139\nDISTANCE:dark 1.0120134 1.0446024\n```\n\n\n:::\n\n```{.r .cell-code}\n# Drop in deviance test\nanova(breg2, breg3, test=\"Chisq\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table\n\nModel 1: prop1 ~ DISTANCE + dark\nModel 2: prop1 ~ DISTANCE + dark + DISTANCE:dark\n  Resid. Df Resid. Dev Df Deviance  Pr(>Chi)    \n1        11     25.161                          \n2        10     13.230  1   11.931 0.0005519 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Test goodness of fit for full model\ngof <- 1-pchisq(breg3$deviance, breg3$df.residual)\ngof  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.2111003\n```\n\n\n:::\n\n```{.r .cell-code}\n# Plot full model (with interaction)\nmoth <- mutate(moth, breg3.pred = predict(breg3, type=\"link\") )\nggplot(data = moth, aes(x = DISTANCE, color = MORPH, shape = MORPH)) + \n  geom_point(aes(y = logit1)) + \n  geom_smooth(aes(y = breg3.pred), method=\"lm\") +\n  ggtitle(\"Full model (with interaction)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/model_breg3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Construct table of predicted values and prediction errors\nbin.prop = moth$prop1\nmodel.est = predict(breg3, type=\"response\")\ndev.resid = residuals(breg3, type=\"deviance\")\npears.resid = residuals(breg3, type=\"pearson\")\ndisplay1 = data.frame(DISTANCE=moth$DISTANCE, MORPH=moth$MORPH, bin.prop, \n  model.est, dev.resid, pears.resid)\ndisplay1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   DISTANCE MORPH  bin.prop model.est   dev.resid pears.resid\n1       0.0 light 0.3035714 0.3278932 -0.39029161 -0.38770684\n2       0.0  dark 0.2500000 0.2443482  0.09817395  0.09842764\n3       7.2 light 0.3500000 0.3133306  0.70012843  0.70708882\n4       7.2  dark 0.2500000 0.2697738 -0.40168046 -0.39848098\n5      24.1 light 0.3461538 0.2805892  1.03033392  1.05231913\n6      24.1  dark 0.4230769 0.3355738  1.31241839  1.33631238\n7      30.2 light 0.1500000 0.2692974 -2.21182753 -2.08314815\n8      30.2  dark 0.2666667 0.3611865 -1.56021941 -1.52421287\n9      36.4 light 0.2666667 0.2581190  0.15076812  0.15130310\n10     36.4  dark 0.3833333 0.3880529 -0.07507580 -0.07501947\n11     41.5 light 0.2380952 0.2491537 -0.23551483 -0.23432889\n12     41.5  dark 0.4761905 0.4106830  1.21248773  1.22040170\n13     51.2 light 0.2608696 0.2326848  0.63131047  0.63978903\n14     51.2  dark 0.4239130 0.4547068 -0.59447466 -0.59316567\n```\n\n\n:::\n:::\n\n\n### Code Exercises 10-11\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Adjusting for extra-binomial variation (overdispersion)\nbreg4 <- glm(prop1 ~ DISTANCE + dark + DISTANCE:dark, weights = PLACED,\n             family = quasibinomial, data = moth)\nsummary(breg4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ DISTANCE + dark + DISTANCE:dark, family = quasibinomial, \n    data = moth, weights = PLACED)\n\nCoefficients:\n               Estimate Std. Error t value Pr(>|t|)   \n(Intercept)   -0.717729   0.214423  -3.347   0.0074 **\nDISTANCE      -0.009287   0.006525  -1.423   0.1851   \ndark          -0.411257   0.309439  -1.329   0.2134   \nDISTANCE:dark  0.027789   0.009115   3.049   0.0123 * \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for quasibinomial family taken to be 1.270859)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 13.230  on 10  degrees of freedom\nAIC: NA\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\nexp(coef(breg4))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n    0.4878587     0.9907562     0.6628165     1.0281788 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Adjusted drop in deviance test\nbreg4a <- glm(prop1 ~ DISTANCE + dark, weights = PLACED,\n              family = quasibinomial, data = moth)\nsummary(breg4a)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ DISTANCE + dark, family = quasibinomial, \n    data = moth, weights = PLACED)\n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -1.136742   0.235365  -4.830 0.000528 ***\nDISTANCE     0.005314   0.006008   0.884 0.395404    \ndark         0.404052   0.209269   1.931 0.079680 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for quasibinomial family taken to be 2.25436)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 25.161  on 11  degrees of freedom\nAIC: NA\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(breg4a, breg4, test = \"F\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table\n\nModel 1: prop1 ~ DISTANCE + dark\nModel 2: prop1 ~ DISTANCE + dark + DISTANCE:dark\n  Resid. Df Resid. Dev Df Deviance      F  Pr(>F)  \n1        11     25.161                             \n2        10     13.230  1   11.931 9.3885 0.01196 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Find phi = overdispersion parrameter\nphi.num = sum(pears.resid^2)\nphi.denom = breg3$df.residual   # equals 14-4\nphihat = phi.num / phi.denom\nphihat\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.270859\n```\n\n\n:::\n\n```{.r .cell-code}\nsqrt(phihat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.127324\n```\n\n\n:::\n\n```{.r .cell-code}\n# Significance tests for interaction term after adjust for overdispersion\ndropindev = breg2$deviance - breg3$deviance\nd = breg2$df.residual - breg3$df.residual\nFstat = (dropindev/d) / phihat\npval = 1-pf(Fstat, d, breg3$df.residual)\nFstat\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 9.388515\n```\n\n\n:::\n\n```{.r .cell-code}\npval    # p-value from adjusted Drop in Deviance test\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.01196119\n```\n\n\n:::\n\n```{.r .cell-code}\nbeta = summary(breg4)$coefficients[4,1]\nsebeta = summary(breg4)$coefficients[4,2]\ntstat = beta / sebeta\npval = 2*(1-pt(tstat, breg4$df.residual))\ntstat\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3.048731\n```\n\n\n:::\n\n```{.r .cell-code}\npval    # p-value from adjusted Wald test\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.01227827\n```\n\n\n:::\n\n```{.r .cell-code}\n# Generate adjusted CIs - profile likelihood method\nexp(confint(breg4))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWaiting for profiling to be done...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  2.5 %    97.5 %\n(Intercept)   0.3174445 0.7373944\nDISTANCE      0.9781472 1.0035420\ndark          0.3601859 1.2143078\nDISTANCE:dark 1.0100422 1.0468234\n```\n\n\n:::\n\n```{.r .cell-code}\n# Generate adjusted CIs - Wald-based method\nqlcoef = summary(breg4)$coefficients[,1]\nqlse = summary(breg4)$coefficients[,2]\nlb = qlcoef - qt(.975,breg4$df.residual)*qlse\nub = qlcoef + qt(.975,breg4$df.residual)*qlse\ncbind(exp(lb),exp(ub))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                   [,1]      [,2]\n(Intercept)   0.3025549 0.7866545\nDISTANCE      0.9764554 1.0052664\ndark          0.3326282 1.3207711\nDISTANCE:dark 1.0075077 1.0492739\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Note relationships between betas and SE(betas) under maximum \n# likelihood (sebetas) and quasi likelihood (qlse):\nqlse\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n  0.214422569   0.006525361   0.309438917   0.009114954 \n```\n\n\n:::\n\n```{.r .cell-code}\nsebetas\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n  0.190204947   0.005788365   0.274489822   0.008085480 \n```\n\n\n:::\n\n```{.r .cell-code}\nsqrt(phihat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.127324\n```\n\n\n:::\n\n```{.r .cell-code}\nsebetas*sqrt(phihat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n  0.214422569   0.006525361   0.309438916   0.009114954 \n```\n\n\n:::\n\n```{.r .cell-code}\nqlcoef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n -0.717729416  -0.009286783  -0.411257136   0.027789044 \n```\n\n\n:::\n\n```{.r .cell-code}\nbetas\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)      DISTANCE          dark DISTANCE:dark \n -0.717729416  -0.009286783  -0.411257136   0.027789044 \n```\n\n\n:::\n:::\n\n\n\n### Exercises 12 and 13\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Distance as factor variable\nmoth <- mutate(moth, location = as.factor(DISTANCE) )\nbreg5 = glm(prop1 ~ location + dark, weights = PLACED, \n            family = binomial, data = moth)\nsummary(breg5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ location + dark, family = binomial, data = moth, \n    weights = PLACED)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   -1.1739     0.2254  -5.207 1.92e-07 ***\nlocation7.2    0.1141     0.2739   0.417  0.67686    \nlocation24.1   0.4950     0.2933   1.688  0.09148 .  \nlocation30.2  -0.3774     0.3096  -1.219  0.22287    \nlocation36.4   0.2316     0.2886   0.802  0.42236    \nlocation41.5   0.3760     0.2667   1.410  0.15864    \nlocation51.2   0.3105     0.2633   1.179  0.23829    \ndark           0.4083     0.1401   2.914  0.00357 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 35.385  on 13  degrees of freedom\nResidual deviance: 14.774  on  6  degrees of freedom\nAIC: 93.449\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbreg5a = glm(prop1 ~ location + dark + location:dark, weights = PLACED,\n            family = binomial, data = moth)\nsummary(breg5a)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = prop1 ~ location + dark + location:dark, family = binomial, \n    data = moth, weights = PLACED)\n\nCoefficients:\n                  Estimate Std. Error z value Pr(>|z|)   \n(Intercept)        -0.8303     0.2906  -2.857  0.00428 **\nlocation7.2         0.2113     0.3734   0.566  0.57143   \nlocation24.1        0.1944     0.4116   0.472  0.63680   \nlocation30.2       -0.9043     0.4639  -1.949  0.05126 . \nlocation36.4       -0.1813     0.4119  -0.440  0.65994   \nlocation41.5       -0.3328     0.3874  -0.859  0.39032   \nlocation51.2       -0.2111     0.3753  -0.563  0.57376   \ndark               -0.2683     0.4239  -0.633  0.52685   \nlocation7.2:dark   -0.2113     0.5489  -0.385  0.70027   \nlocation24.1:dark   0.5941     0.5861   1.014  0.31071   \nlocation30.2:dark   0.9913     0.6290   1.576  0.11504   \nlocation36.4:dark   0.8044     0.5792   1.389  0.16484   \nlocation41.5:dark   1.3361     0.5413   2.468  0.01358 * \nlocation51.2:dark   1.0030     0.5297   1.893  0.05829 . \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 3.5385e+01  on 13  degrees of freedom\nResidual deviance: 8.2157e-15  on  0  degrees of freedom\nAIC: 90.674\n\nNumber of Fisher Scoring iterations: 3\n```\n\n\n:::\n\n```{.r .cell-code}\ngof = 1-pchisq(breg5a$deviance, breg5a$df.residual)\ngof\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Try running as logistic regression.  \n#    First must expand data to one row per moth.\nmtemp1 = rep(moth$dark[1],moth$REMOVED[1])\ndtemp1 = rep(moth$DISTANCE[1],moth$REMOVED[1])\nrtemp1 = rep(1,moth$REMOVED[1])\nmtemp1 = c(mtemp1,rep(moth$dark[1],moth$PLACED[1]-moth$REMOVED[1]))\ndtemp1 = c(dtemp1,rep(moth$DISTANCE[1],moth$PLACED[1]-moth$REMOVED[1]))\nrtemp1 = c(rtemp1,rep(0,moth$PLACED[1]-moth$REMOVED[1]))\nfor(i in 2:14)  {\n  mtemp1 = c(mtemp1,rep(moth$dark[i],moth$REMOVED[i]))\n  dtemp1 = c(dtemp1,rep(moth$DISTANCE[i],moth$REMOVED[i]))\n  rtemp1 = c(rtemp1,rep(1,moth$REMOVED[i]))\n  mtemp1 = c(mtemp1,rep(moth$dark[i],moth$PLACED[i]-moth$REMOVED[i]))\n  dtemp1 = c(dtemp1,rep(moth$DISTANCE[i],moth$PLACED[i]-moth$REMOVED[i]))\n  rtemp1 = c(rtemp1,rep(0,moth$PLACED[i]-moth$REMOVED[i]))  }\nnewdata = data.frame(removed=rtemp1,dark=mtemp1,dist=dtemp1)\nnewdata[1:25,]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   removed dark dist\n1        1    0    0\n2        1    0    0\n3        1    0    0\n4        1    0    0\n5        1    0    0\n6        1    0    0\n7        1    0    0\n8        1    0    0\n9        1    0    0\n10       1    0    0\n11       1    0    0\n12       1    0    0\n13       1    0    0\n14       1    0    0\n15       1    0    0\n16       1    0    0\n17       1    0    0\n18       0    0    0\n19       0    0    0\n20       0    0    0\n21       0    0    0\n22       0    0    0\n23       0    0    0\n24       0    0    0\n25       0    0    0\n```\n\n\n:::\n\n```{.r .cell-code}\ncdplot(as.factor(rtemp1)~dtemp1)\n```\n\n::: {.cell-output-display}\n![](04_moths_fillable_files/figure-html/compare_logistic-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlreg1 = glm(rtemp1 ~ mtemp1 + dtemp1 + mtemp1:dtemp1,\n  family=binomial(link=\"logit\") )\nsummary(lreg1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = rtemp1 ~ mtemp1 + dtemp1 + mtemp1:dtemp1, family = binomial(link = \"logit\"))\n\nCoefficients:\n               Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   -0.717729   0.190205  -3.773 0.000161 ***\nmtemp1        -0.411257   0.274490  -1.498 0.134065    \ndtemp1        -0.009287   0.005788  -1.604 0.108628    \nmtemp1:dtemp1  0.027789   0.008085   3.437 0.000588 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1207.9  on 967  degrees of freedom\nResidual deviance: 1185.7  on 964  degrees of freedom\nAIC: 1193.7\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\n# Try running as a multilevel model\nlibrary(lme4)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lme4' was built under R version 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Matrix\n```\n\n\n:::\n\n```{.r .cell-code}\nid1 = as.factor(dtemp1)\nmodel1 = glmer(rtemp1 ~ mtemp1 + dtemp1 + mtemp1:dtemp1 + (1|id1), family=binomial)\nsummary(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: binomial  ( logit )\nFormula: rtemp1 ~ mtemp1 + dtemp1 + mtemp1:dtemp1 + (1 | id1)\n\n     AIC      BIC   logLik deviance df.resid \n  1195.5   1219.9   -592.8   1185.5      963 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-0.9114 -0.6946 -0.5859  1.1770  1.8210 \n\nRandom effects:\n Groups Name        Variance Std.Dev.\n id1    (Intercept) 0.01148  0.1072  \nNumber of obs: 968, groups:  id1, 7\n\nFixed effects:\n               Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   -0.719793   0.205495  -3.503 0.000461 ***\nmtemp1        -0.411110   0.274779  -1.496 0.134615    \ndtemp1        -0.009341   0.006270  -1.490 0.136263    \nmtemp1:dtemp1  0.027818   0.008094   3.437 0.000588 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) mtemp1 dtemp1\nmtemp1      -0.641              \ndtemp1      -0.843  0.538       \nmtmp1:dtmp1  0.558 -0.859 -0.660\n```\n\n\n:::\n:::\n",
    "supporting": [
      "04_moths_fillable_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}