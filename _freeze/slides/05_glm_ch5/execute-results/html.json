{
  "hash": "db912fb3895f0b680d76bd0552658e54",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Generalized Linear Models (GLMs)\"\nsubtitle: \"BMLR Chapter 5\"\nformat: \n  revealjs:\n    output-file: \"05_glm_ch5.html\"\n    slide-number: true\n  html:\n    output-file: \"05_glm_ch5_o.html\"\nlogo: \"/img/favicon.png\"\n---\n\n::: {.cell}\n\n:::\n\n\n\n## Learning goals \n\n- Identify the components common to all generalized linear models \n\n- Find the canonical link based on the distribution of the response variable \n\n- Explain how coefficients are estimated using iteratively reweighted least squares (IWLS)\n\n\n# Unifying theory of GLMs\n\n## Many models; one family {.smaller}\n\nWe have studied models for a variety of response variables\n\n- Least squares (Normal)\n- Logistic (Bernoulli, Binomial, Multinomial)\n- Log-linear (Poisson, Negative Binomial)\n\n. . .\n\nThese models are all examples of **generalized linear models**.\n\nGLMs have a similar structure for their likelihoods, MLEs, variances, so we can use a generalized approach to find the model estimates and associated uncertainty.\n\n\n\n## Components of a GLM {.smaller}\n\n[Nelder and Wdderburn (1972)](https://sakai.duke.edu/access/content/group/ec265469-bdb3-47a7-beb0-317956b6f86f/GLM-paper.pdf) defines a broad class of models called **generalized linear models** that generalizes multiple linear regression. GLMs are characterized by three components: \n\n. . .\n\n1️⃣ Response variable with parameter $\\theta$ whose probability function can be written in exponential family form (**random component**)\n\n2️⃣ A linear combination of predictors, $\\eta = \\beta_1 x_1 + \\beta_2 x_2 + \\dots + \\beta_p x_p$ (**systematic component**)\n\n3️⃣ A **link** function $g(\\theta)$ that connects $\\theta$ to $\\eta$\n\n::: aside\nNelder, J. A., & Wedderburn, R. W. (1972). Generalized linear models. Journal of the Royal Statistical Society: Series A (General), 135(3), 370-384.\n:::\n\n\n\n## Exponential family form {.smaller}\n\nSuppose a probability (mass or density) function has a parameter $\\theta$. It is said to have a **one-parameter exponential family form** if \n\n. . .\n\n✅  The support (set of possible values) does not depend on $\\theta$, and \n\n. . .\n\n✅ The probability function can be written in the following form\n\n$f(y;\\theta) = e^{[a(y)b(\\theta) + c(\\theta) + d(y)]}$\n\n. . .\n\nUsing this form: \n\n$$E(Y) = -\\frac{c'(\\theta)}{b'(\\theta)} \\hspace{20mm} Var(Y) = \\frac{b''(\\theta)c'(\\theta) - c''(\\theta)b'(\\theta)}{[b'(\\theta)]^3}$$\n\n\n\n## Poisson in exponential family form {.smaller}\n\n$$P(Y = y) = \\frac{e^{-\\lambda}\\lambda^y}{y!} \\hspace{10mm} y = 0, 1, 2, \\ldots, \\infty$$\n\n. . .\n\n$$\\begin{aligned}P(Y = y) &= e^{-\\lambda}e^{y\\log(\\lambda)}e^{-\\log(y!)}\\\\\n& = e^{y\\log(\\lambda) - \\lambda - \\log(y!)}\\end{aligned}$$\n\n. . .\n\nRecall the form: $f(y;\\theta) = e^{[a(y)b(\\theta) + c(\\theta) + d(y)]}$, where the parameter $\\theta = \\lambda$ for the Poisson distribution\n\n:::: {.columns}\n::: {.column}\n- $a(y) = y$\n- $b(\\lambda) = \\log(\\lambda)$\n\n:::\n\n:::{.column}\n\n- $c(\\lambda) = -\\lambda$\n- $d(y) = -\\log(y!)$\n\n:::\n::::\n\n## Poisson in exponential family form {.smaller}\n\n- The support for the Poisson distribution is $y = 0, 1, 2, \\ldots, \\infty$. This does not depend on the parameter $\\lambda$. \n\n- The probability mass function can be written in the form $f(y;\\theta) = e^{[a(y)b(\\theta) + c(\\theta) + d(y)]}$\n\n. . .\n\n**The Poisson distribution can be written in one-parameter exponential family form.**\n\n\n\n## Canonical link {.smaller}\n\nSuppose there is a response variable $Y$ from a distribution with parameter $\\theta$ and a set of predictors that can be written as a linear combination $\\eta = \\sum_{j=1}^{p}\\beta_jx_j = \\beta_1 x_1 + \\beta_2 x_2 + \\dots + \\beta_p x_p$\n\n<br>\n\n**(There does not have to be an intercept but generally we also include $\\beta_0$)**\n\n<br> \n\n. . .\n\nA **link function**, $g()$, is a monotonic and differentiable function that connects $\\theta$ to $\\eta$\n\n. . .\n\nThe **canonical link** is a link function such that $g(\\theta) = \\eta$\n\n- When working with a member of the one-parameter exponential family, the canonical link is $b(\\theta)$\n\n\n\n## Canonical link for Poisson {.smaller}\n\nRecall \n\n$$P(Y = y) = e^{y\\log(\\lambda) - \\lambda - \\log(y!)}$$\n\nthen the canonical link is $b(\\lambda) = \\log(\\lambda)$\n\n\n\n## GLM framework: Poisson response variable {.smaller}\n\n1️⃣ Response variable with parameter $\\theta$ whose probability function can be written in exponential family form\n\n$$P(Y = y) = e^{y\\log(\\lambda) - \\lambda - \\log(y!)}$$\n\n. . .\n\n2️⃣ A linear combination of predictors, $\\eta = \\beta_0 + \\beta_1 x_1 + \\beta_2 x_2 + \\dots + \\beta_p x_p$\n\n. . .\n\n3️⃣ A function $g(\\lambda)$ that connects $\\lambda$ and $\\eta$ \n\n$$\\log(\\lambda) = \\eta =  \\beta_0 + \\beta_1 x_1 + \\beta_2 x_2 + \\dots + \\beta_p x_p$$\n\n\n\n## Activity: Identifying canonical link {.smaller}\n\nFor the distribution \n\n- Describe an example of a setting where this random variable may be used.\n\n- Identify the parameter.\n\n- Write the pmf or pdf in one-parameter exponential form. \n\n- Identify the canonical link function\n\n- One person from each group: Write your response on the board. \n\n\n\n## Activity {.smaller}\n\n**Distributions**\n\n1. Binary \n2. Exponential\n3. Negative binomial (with fixed $r$)\n4. Geometric\n5. Normal (with fixed $\\sigma$)\n\n- If your group finishes early, try identifying the canonical link for the other distributions. \n\n- See [BMLR - Section 3.6](https://bookdown.org/roback/bookdown-BeyondMLR/ch-distthry.html#additional-resources) for details on the distributions.\n\n\n\n# Iteratively reweighted least squares (IWLS)\n\n## Data: Noisy Miners {.smaller}\n\nThe dataset [`nminer`](data/nminer.csv) contains information about the number of noisy miners (small Australian bird) detected in two woodland patches within the Wimmera Plains of Victoria, Australia. It was obtained from the **GLMsdata** R package. We will use the following variables:\n\n \n- **`Minerab`**: The number of noisy miners (abundance) observed in three 20 minute surveys\n- **`Eucs`**: The number of eucalyptus trees in each 2 hectare area (about 4.94 acres)\n\n\n\n\n## Noisy Miner Model {.smaller}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| Eucs| Minerab|\n|----:|-------:|\n|    2|       0|\n|   10|       0|\n|   16|       3|\n|   20|       2|\n|   19|       8|\n\n\n:::\n:::\n\n\n. . .\n\nOur goal is to use a Poisson regression model to predict the number of noisy miners observed in three 20 minute surveys based on the number of eucalyptus trees.\n\n$$\\log(\\lambda_{Minearab}) = \\beta_0 + \\beta_1 ~ Euc$$\n\n. . .\n\n**What are the best estimates of $\\beta_0$ and $\\beta_1$?**\n\n\n\n\n## Iteratively reweighted least squares (IWLS) {.smaller}\n\n- The estimates of $\\beta_0$ and $\\beta_1$ are found using maximum likelihood estimation. \n\n\n- **Iteratively reweighted least-squares (IWLS)** is used to find the MLEs\n  - Nelder and Wedderburn (1972) show that under certain specifications of the weights and a modified response variable, the estimates found using IWLS are equivalent to the MLEs.\n  \n\n\n## IWLS Set up {.smaller}\n\n**Working response**: Modified response variable at each step of the iteration. \n\n$$z_i = g(\\theta) + g'(\\theta)(y_i - \\theta_i)$$\n\nFor Poisson regression, this is \n\n$$z_i = \\log(\\lambda) + \\frac{(y_i - \\lambda_i)}{\\lambda_i}$$\n\n. . .\n\n**Working Weights:** Weights applied to the observations at each step of the iteration \n\n$$W_i = \\frac{\\theta^2}{Var(Y)} \\hspace{5mm} \\Rightarrow \\hspace{5mm}  W_i = \\frac{\\lambda^2}{\\lambda} =  \\lambda \\text{ for Poisson regression}$$\n\n\n\n## IWLS procedure {.smaller}\n\n1. Find initial starting values $\\hat{\\theta}_i$.\n\n2. Calculate the working response values $z_i$.\n\n3. Calculate the working weights $W_i$.\n\n4. Find the coefficient estimates of the weighted least squares model.\n\n. . .\n\n$z_i = \\beta_0 + \\beta_1 x \\hspace{5mm} \\text{ with weights }W_i$\n\nThe estimates $\\hat{\\beta}_0$ and $\\hat{\\beta}_1$ are the estimates for the model coefficients. \n\n. . .\n\nUse $\\hat{\\beta}_0$ and $\\hat{\\beta}_1$ to calculate updated values of $\\hat{\\theta}_i$ and repeat steps 2 - 4 until convergence.\n\n\n\n. . .\n\n## Demo in `ch5_iwls.R` in server class files\n\n\n\n## Acknowledgements {.smaller}\n\n- These slides are based on content in [BMLR: Chapter 4](https://bookdown.org/roback/bookdown-BeyondMLR/)\n\n- Initial versions of the slides are by Dr. Maria Tackett, Duke University\n\n- [BMLR: Chapter 5 - Generalized Linear Models: A Unifying Theory](https://bookdown.org/roback/bookdown-BeyondMLR/ch-glms.html)\n- Nelder, J. A., & Wedderburn, R. W. (1972). Generalized linear models. Journal of the Royal Statistical Society: Series A (General), 135(3), 370-384.\n- Generalized Linear Models with Examples in R\n  - Chapter 5 - Generalized Linear Models: Structure\n  - Chapter 6 - Generalized Linear Models: Estimation \n  ",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}